(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{a:()=>X}),document.querySelectorAll(".popup");var t=document.querySelector(".popup_editElement"),n=t.querySelector(".popup__container"),o=n.querySelector(".popup__profile-edit"),r=o.querySelector(".popup__input"),c=r.querySelector(".popup__input-field_type_name"),u=r.querySelector(".popup__input-field_type_description"),i=document.querySelector(".popup_addElement"),l=i.querySelector(".popup__container"),a=l.querySelector(".popup__profile-edit"),s=a.querySelector(".popup__input"),p=s.querySelector(".popup__input-field_type_name"),d=s.querySelector(".popup__input-field_type_description"),_=document.querySelector(".popup_picture"),f=_.querySelector(".popup__picture-img"),v=_.querySelector(".popup__picture-text"),m=document.querySelector(".popup_editAvatar"),y=m.querySelector(".popup__container"),S=y.querySelector(".popup__profile-edit"),h=S.querySelector(".popup__input").querySelector(".popup__input-field_type_avatar"),b=document.querySelector(".profile"),q=b.querySelector(".profile__author").querySelector(".profile__container"),g=q.querySelector(".profile__info"),E=g.querySelector(".profile__name"),L=q.querySelector(".profile__description"),C=document.querySelector(".elements"),k=C.querySelector(".element"),x=(k.querySelector(".element__description"),document.querySelector(".profile__avatar-container")),B=x.querySelector(".profile__avatar"),A=b.querySelector(".profile__add-button"),U=g.querySelector(".profile__edit-button"),O=o.querySelector(".popup__button"),P=a.querySelector(".popup__button"),T=S.querySelector(".popup__button"),j={baseUrl:"https://nomoreparties.co/v1/plus-cohort-4",header:{authorization:"7fbcd172-bf5b-475f-bf14-ccd6d6f0291e","Content-Type":"application/json"}};function D(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var N=function(e){return fetch("".concat(j.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:j.header}).then((function(e){return D(e)}))},w=function(e){return fetch("".concat(j.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:j.header}).then((function(e){return D(e)}))},J=function(e){return fetch("".concat(j.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:j.header}).then((function(e){return D(e)}))};function M(e,t){e.value="",t.value=""}function H(e){e.classList.add(X.inactiveButtonClass),e.setAttribute("disabled","disabled")}function z(e){"Escape"===e.key&&G(document.querySelector(".popup_opened"))}function F(e){e.classList.add("popup_opened"),document.addEventListener("keydown",z)}function G(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",z)}function I(e,t){e?(t.value="Сохранение...",t.textContent="Сохранение..."):(t.value="Сохранить",t.textContent="Сохранить")}function K(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:X.id,r=arguments.length>4?arguments[4]:void 0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],u=document.querySelector("#element-template").content,i=u.querySelector(".element").cloneNode(!0),l=i.querySelector(".element__delete"),a=i.querySelector(".element__button"),s=i.querySelector(".element__likes");return Q(l,o,X.id),i.querySelector(".element__text").textContent=e,i.querySelector(".element__photo").src=t,i.querySelector(".element__photo").alt=e+" фото",i.querySelector(".element__photo").addEventListener("click",(function(n){F(_),f.src=t,f.alt=e+" фото",v.textContent=e})),n||R(X.id,c,a),a.addEventListener("click",(function(e){e.target.classList.contains("element__button_activated")?J(r).then((function(t){e.target.classList.remove("element__button_activated"),s.textContent=t.likes.length})).catch((function(e){console.log(e)})):w(r).then((function(t){e.target.classList.add("element__button_activated"),s.textContent=t.likes.length})).catch((function(e){console.log(e)}))})),s.textContent=c.length,l.addEventListener("click",(function(){N(r).then((function(e){l.closest(".element").remove()})).catch((function(e){console.log(e)}))})),i}function Q(e,t,n){t!==String(n)&&e.parentNode.removeChild(e)}function R(e,t,n){t.forEach((function(t){t._id===e?n.classList.add("element__button_activated"):n.classList.remove("element__button_activated")}))}function V(e){var t=Array.from(e.querySelectorAll(X.inputSelector));t.forEach((function(n){n.addEventListener("input",(function(){(function(e,t){t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(X.inputErrorClass),n.classList.remove(X.errorClass),n.textContent=""}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(X.inputErrorClass),function(e,t,n){e.validity.valueMissing?t.textContent="Вы пропустили это поле.":e.validity.typeMismatch?t.textContent="Введите адрес сайта.":t.textContent=n}(t,o,n),o.classList.add(X.errorClass)}(e,t,t.validationMessage)})(e,n),function(e,t){var n=t.querySelector(X.submitButtonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(n.classList.remove(X.inactiveButtonClass),n.removeAttribute("disabled","disabled")):(n.classList.add(X.inactiveButtonClass),n.setAttribute("disabled","disabled"))}(t,e)}))}))}U.addEventListener("click",(function(){F(t),c.value=E.textContent,u.value=L.textContent})),n.addEventListener("submit",(function(e){var n,o;e.preventDefault(),e.target.closest(".popup__button_disabled")||(I(!0,O),(n=c.value,o=u.value,fetch("".concat(j.baseUrl,"/users/me"),{method:"PATCH",headers:j.header,body:JSON.stringify({name:n,about:o})}).then((function(e){return D(e)}))).then((function(e){E.textContent=c.value,L.textContent=u.value,G(t)})).finally((function(e){I(!1,O)})).catch((function(e){console.log(e)})))})),l.addEventListener("submit",(function(e){var t,n;e.preventDefault(),e.target.closest(".popup__button_disabled")||(I(!0,P),(t=p.value,n=d.value,fetch("".concat(j.baseUrl,"/cards"),{method:"POST",headers:j.header,body:JSON.stringify({name:t,link:n})}).then((function(e){return D(e)}))).then((function(t){C.insertBefore(K(t.name,t.link,!0,X.id,t._id),k),G(i),M(p,d),null!==e.target.querySelector(X.submitButtonSelector)&&H(e.target.querySelector(X.submitButtonSelector))})).finally((function(e){I(!1,P)})).catch((function(e){console.log(e)})))})),y.addEventListener("submit",(function(e){var t;e.preventDefault(),e.target.closest(".popup__button_disabled")||(I(!0,T),(t=h.value,fetch("".concat(j.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:j.header,body:JSON.stringify({avatar:t})}).then((function(e){return D(e)}))).then((function(t){console.log(t),B.src=h.value,G(m),M(h,h),null!==e.target.querySelector(X.submitButtonSelector)&&H(e.target.querySelector(X.submitButtonSelector))})).finally((function(e){I(!1,T)})).catch((function(e){console.log(e)})))})),A.addEventListener("click",(function(e){e.target.closest(".popup__profile-edit")||F(i),"Сохранить"===P.value&&null!==e.target.closest(X.submitButtonSelector)&&H(e.target.closest(X.submitButtonSelector))})),i.addEventListener("click",(function(e){e.target.closest(".popup__profile-edit")||G(i),null!==e.target.querySelector(X.submitButtonSelector)&&H(e.target.querySelector(X.submitButtonSelector))})),_.addEventListener("click",(function(e){e.target.closest(".popup__picture-img")||G(_)})),t.addEventListener("click",(function(e){e.target.closest(".popup__profile-edit")||G(t)})),x.addEventListener("click",(function(e){e.target.closest(".popup__profile-edit")||F(m),"Сохранить"===T.value&&null!==e.target.closest(X.submitButtonSelector)&&H(e.target.closest(X.submitButtonSelector))})),m.addEventListener("click",(function(e){e.target.closest(".popup__profile-edit")||G(m)}));var W,X={formSelector:".popup__container",inputSelector:".popup__input-field",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};fetch("".concat(j.baseUrl,"/users/me"),{headers:j.header}).then((function(e){return D(e)})).then((function(e){var t;t=e,E.textContent=t.name,L.textContent=t.about,B.src=t.avatar,W=String(t._id),X.id=W,function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){V(e)}))}(X),fetch("".concat(j.baseUrl,"/cards"),{headers:j.header}).then((function(e){return D(e)})).then((function(e){e.forEach((function(e){C.append(K(e.name,e.link,!1,e.owner._id,e._id,e.likes))}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))})();