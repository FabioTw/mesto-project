(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{a:()=>Y}),document.querySelectorAll(".popup");var t=document.querySelector(".popup_editElement"),n=t.querySelector(".popup__container"),o=n.querySelector(".popup__profile-edit"),r=o.querySelector(".popup__input"),u=r.querySelector(".popup__input-field_type_name"),c=r.querySelector(".popup__input-field_type_description"),i=document.querySelector(".popup_addElement"),l=i.querySelector(".popup__container"),a=l.querySelector(".popup__profile-edit"),s=a.querySelector(".popup__input"),p=s.querySelector(".popup__input-field_type_name"),d=s.querySelector(".popup__input-field_type_description"),_=document.querySelector(".popup_picture"),f=_.querySelector(".popup__picture-img"),m=_.querySelector(".popup__picture-text"),v=document.querySelector(".popup_editAvatar"),y=v.querySelector(".popup__container"),S=y.querySelector(".popup__profile-edit"),b=S.querySelector(".popup__input").querySelector(".popup__input-field_type_avatar"),h=document.querySelector(".profile"),q=h.querySelector(".profile__author").querySelector(".profile__container"),g=q.querySelector(".profile__info"),C=g.querySelector(".profile__name"),E=q.querySelector(".profile__description"),L=document.querySelector(".elements"),k=L.querySelector(".element"),x=(k.querySelector(".element__description"),document.querySelector(".profile__avatar-container")),B=x.querySelector(".profile__avatar"),A=h.querySelector(".profile__add-button"),U=g.querySelector(".profile__edit-button"),N=o.querySelector(".popup__button"),O=a.querySelector(".popup__button"),P=S.querySelector(".popup__button"),T="34b8f5f953de44277455cfdc",D={baseUrl:"https://nomoreparties.co/v1/plus-cohort-4",header:{authorization:"7fbcd172-bf5b-475f-bf14-ccd6d6f0291e","Content-Type":"application/json"}};function j(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var w,J=function(e){return fetch("".concat(D.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:D.header}).then((function(e){return j(e)}))},M=function(e){return fetch("".concat(D.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:D.header}).then((function(e){return j(e)}))},H=function(e){return fetch("".concat(D.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:D.header}).then((function(e){return j(e)}))};function z(e,t){e.value="",t.value=""}function F(e){e.classList.add(Y.inactiveButtonClass),e.setAttribute("disabled","disabled")}function G(e){"Escape"===e.key&&K(document.querySelector(".popup_opened"))}function I(e){e.classList.add("popup_opened"),document.addEventListener("keydown",G)}function K(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",G)}function Q(e,t){e?(t.value="Сохранение...",t.textContent="Сохранение..."):(t.value="Сохранить",t.textContent="Сохранить")}function R(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T,r=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],c=document.querySelector("#element-template").content,i=c.querySelector(".element").cloneNode(!0),l=i.querySelector(".element__delete"),a=i.querySelector(".element__button"),s=i.querySelector(".element__likes");return V(l,o),i.querySelector(".element__text").textContent=e,i.querySelector(".element__photo").src=t,i.querySelector(".element__photo").alt=e+" фото",i.querySelector(".element__photo").addEventListener("click",(function(n){I(_),f.src=t,f.alt=e+" фото",m.textContent=e})),n||W(T,u,a),a.addEventListener("click",(function(e){e.target.classList.contains("element__button_activated")?(H(r),e.target.classList.remove("element__button_activated"),s.textContent=Number(s.textContent)-1):(M(r),e.target.classList.add("element__button_activated"),s.textContent=Number(s.textContent)+1)})),s.textContent=u.length,l.addEventListener("click",(function(){l.closest(".element").remove(),J(r)})),i}function V(e,t){t!==T&&e.parentNode.removeChild(e)}function W(e,t,n){t.forEach((function(t){t._id===e?n.classList.add("element__button_activated"):n.classList.remove("element__button_activated")}))}function X(e){var t=Array.from(e.querySelectorAll(Y.inputSelector));t.forEach((function(n){n.addEventListener("input",(function(){(function(e,t){t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(Y.inputErrorClass),n.classList.remove(Y.errorClass),n.textContent=""}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(Y.inputErrorClass),function(e,t,n){e.validity.valueMissing?t.textContent="Вы пропустили это поле.":e.validity.typeMismatch?t.textContent="Введите адрес сайта.":t.textContent=n}(t,o,n),o.classList.add(Y.errorClass)}(e,t,t.validationMessage)})(e,n),function(e,t){var n=t.querySelector(Y.submitButtonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(n.classList.remove(Y.inactiveButtonClass),n.removeAttribute("disabled","disabled")):(n.classList.add(Y.inactiveButtonClass),n.setAttribute("disabled","disabled"))}(t,e)}))}))}fetch("".concat(D.baseUrl,"/users/me"),{headers:D.header}).then((function(e){return j(e)})).then((function(e){var t;t=e,C.textContent=t.name,E.textContent=t.about,B.src=t.avatar})),U.addEventListener("click",(function(){I(t),u.value=C.textContent,c.value=E.textContent})),n.addEventListener("submit",(function(e){var n,o;e.preventDefault(),e.target.closest(".popup__button_disabled")||(C.textContent=u.value,E.textContent=c.value,Q(!0,N),(n=u.value,o=c.value,fetch("".concat(D.baseUrl,"/users/me"),{method:"PATCH",headers:D.header,body:JSON.stringify({name:n,about:o})}).then((function(e){return j(e)})).finally((function(e){Q(!1,N)}))).then((function(e){K(t)})))})),l.addEventListener("submit",(function(e){var t,n;e.preventDefault(),e.target.closest(".popup__button_disabled")||(Q(!0,O),(t=p.value,n=d.value,fetch("".concat(D.baseUrl,"/cards"),{method:"POST",headers:D.header,body:JSON.stringify({name:t,link:n})}).then((function(e){return j(e)})).finally((function(e){Q(!1,O)}))).then((function(t){L.insertBefore(R(t.name,t.link,!0,T,t._id),k),K(i),z(p,d),null!==e.target.querySelector(Y.submitButtonSelector)&&F(e.target.querySelector(Y.submitButtonSelector))})))})),y.addEventListener("submit",(function(e){var t;e.preventDefault(),e.target.closest(".popup__button_disabled")||(Q(!0,P),(t=B.src,fetch("".concat(D.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:D.header,body:JSON.stringify({avatar:t})}).then((function(e){return j(e)})).finally((function(e){Q(!1,P)}))).then((function(t){B.src=b.value,K(v),z(b,b),null!==e.target.querySelector(Y.submitButtonSelector)&&F(e.target.querySelector(Y.submitButtonSelector))})))})),A.addEventListener("click",(function(e){e.target.closest(".popup__profile-edit")||I(i),"Сохранить"===O.value&&null!==e.target.closest(Y.submitButtonSelector)&&F(e.target.closest(Y.submitButtonSelector))})),i.addEventListener("click",(function(e){e.target.closest(".popup__profile-edit")||K(i),null!==e.target.querySelector(Y.submitButtonSelector)&&F(e.target.querySelector(Y.submitButtonSelector))})),_.addEventListener("click",(function(e){e.target.closest(".popup__picture-img")||K(_)})),t.addEventListener("click",(function(e){e.target.closest(".popup__profile-edit")||K(t)})),x.addEventListener("click",(function(e){e.target.closest(".popup__profile-edit")||I(v),"Сохранить"===P.value&&null!==e.target.closest(Y.submitButtonSelector)&&F(e.target.closest(Y.submitButtonSelector))})),v.addEventListener("click",(function(e){e.target.closest(".popup__profile-edit")||K(v)})),w=L,fetch("".concat(D.baseUrl,"/cards"),{headers:D.header}).then((function(e){return j(e)})).then((function(e){e.forEach((function(e){w.append(R(e.name,e.link,!1,e.owner._id,e._id,e.likes))}))})).catch((function(e){console.log(e)}));var Y={formSelector:".popup__container",inputSelector:".popup__input-field",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(n){n.preventDefault(),Q(!0,t.querySelector(e.submitButtonSelector))})),X(t)}))}(Y)})();